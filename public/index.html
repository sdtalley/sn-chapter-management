<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SN Chapter Management</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- UNAUTHORIZED ACCESS MESSAGE -->
        <div id="unauthorized" class="unauthorized" style="display: none;">
            <h2>Unauthorized Access</h2>
            <p>You do not have permission to access this application.</p>
            <p>Please contact your administrator for access.</p>
        </div>

        <!-- MAIN MENU (Visible by default) -->
        <div id="main-menu" class="main-menu">
            <h2>Chapter Management</h2>
            <div class="nav-buttons">
                <div class="nav-item">
                    <button class="nav-btn" id="btn-member-directory" onclick="window.open('https://www.sigmanu.org/alumni-and-volunteers/directory', '_blank')">Member Directory</button>
                    <p class="nav-description">Search for an Alumni or Collegiate Member</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-verify-candidates" onclick="showPage('verify-candidates')">Verify Candidates</button>
                    <p class="nav-description">Proposed candidates can be verified, provided they have been processed by the General Fraternity (please allow 3 business days following their registration).</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-verify-initiates" onclick="showPage('verify-initiates')">Verify Initiates</button>
                    <p class="nav-description">Candidates can be verified as initiates following their initiation ceremony, and assigned badge numbers. After the initiation fees are received and processed, materials will be sent.</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-roster-info" onclick="showPage('roster-info')">Roster Information</button>
                    <p class="nav-description">Manage your chapter's roster of active candidates and initiates.</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-returning-students" onclick="showPage('returning-students')">Returning Students</button>
                    <p class="nav-description">Add returning students currently marked as Alumni (Left School) or De-Pledge back to your roster</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-officer-info" onclick="showPage('officer-info')">Officer Information</button>
                    <p class="nav-description">Make changes to elected officers.</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-contact-info" onclick="showPage('contact-info')">Chapter Contact Information</button>
                    <p class="nav-description">Update physical and mailing address, or phone number for your chapter.</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-fee-status" onclick="showPage('fee-status')">Fee Status</button>
                    <p class="nav-description">Review candidate and initiate fee paid status for members of your chapter.</p>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" id="btn-admin" onclick="showPage('admin')">Admin</button>
                </div>
            </div>
        </div>

        <!-- VERIFY CANDIDATES PAGE -->
        <div id="verify-candidates" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Verify Candidates</h2>
            
            <div class="loading-message" id="candidates-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading prospective candidates...</p>
            </div>
            
            <div id="candidates-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="candidates-chapter">-</span></p>
                    <p><strong>Total Prospective Candidates:</strong> <span id="candidates-count">0</span></p>
                    <div class="same-date-control">
                        <label class="checkbox-label">
                            <input type="checkbox" id="candidates-same-date-checkbox" class="same-date-checkbox">
                            <span>Use the same ceremony date for all</span>
                        </label>
                        <input type="date" id="candidates-same-date-picker" class="date-input same-date-picker" disabled>
                    </div>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="candidates-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Approve</th>
                                <th>Candidate Ceremony Date</th>
                            </tr>
                        </thead>
                        <tbody id="candidates-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="reviewCandidateChanges()">Review Changes</button>
                </div>
            </div>
            
            <!-- CANDIDATES REVIEW SECTION -->
            <div id="candidates-review" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="candidates-review-chapter">-</span></p>
                    <p><strong>Changes to Submit:</strong> <span id="candidates-review-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="candidates-review-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Approval Status</th>
                                <th>Candidate Ceremony Date</th>
                            </tr>
                        </thead>
                        <tbody id="candidates-review-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="backToCandidates()">Back</button>
                    <button class="btn" onclick="submitCandidateVerifications()">Submit</button>
                </div>
            </div>
            
            <div id="candidates-error" class="error-message" style="display: none;">
                <p>Error loading candidates. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadCandidates()">Retry</button>
            </div>
        </div>

        <!-- VERIFY INITIATES PAGE -->
        <div id="verify-initiates" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Verify Initiates</h2>
            
            <div class="loading-message" id="initiates-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading candidates...</p>
            </div>
            
            <div id="initiates-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="initiates-chapter">-</span></p>
                    <p><strong>Total Candidates:</strong> <span id="initiates-count">0</span></p>
                    <p id="last-badge-info" style="display: none;"><strong>The last badge assigned is <span id="last-badge-number">-</span>.</strong></p>
                    <div class="same-date-control">
                        <label class="checkbox-label">
                            <input type="checkbox" id="initiates-same-date-checkbox" class="same-date-checkbox">
                            <span>Use the same ceremony date for all</span>
                        </label>
                        <input type="date" id="initiates-same-date-picker" class="date-input same-date-picker" disabled>
                    </div>
                </div>
                
                <!-- New description section for Verify Initiates -->
                <div class="page-description">
                    <p>Enter an initiate ceremony date and badge number for the listed candidates below.</p> 
                    <p>The Initiate Ceremony Date must be accurate, and greater than the Candidate Ceremony Date. If the Candidate Ceremony Date is incorrect, please send the names and correct dates to <a href="mailto:members.area@sigmanu.org?subject=Candidate Ceremony Date Correction">members.area@sigmanu.org</a> for correction before verifying the initiation here.</p>
                    <p>Please ensure all badge numbers assigned/submitted are sequential with no skips. Your current badge submission should start with the badge number immediately following the last badge assigned. If the last badge shown does not match your records it is possible previous badges were reported incorrectly.</p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="initiates-table">
                        <thead>
                            <tr>
                                <th>Initiated</th>
                                <th>Name</th>
                                <th>Candidate Ceremony Date</th>
                                <th>Initiate Ceremony Date</th>
                                <th>Badge Number</th>
                            </tr>
                        </thead>
                        <tbody id="initiates-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="reviewInitiateChanges()">Review Changes</button>
                </div>
            </div>
            
            <!-- INITIATES REVIEW SECTION -->
            <div id="initiates-review" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="initiates-review-chapter">-</span></p>
                    <p><strong>Changes to Submit:</strong> <span id="initiates-review-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="initiates-review-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Initiate Ceremony Date</th>
                                <th>Badge Number</th>
                            </tr>
                        </thead>
                        <tbody id="initiates-review-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="backToInitiates()">Back</button>
                    <button class="btn" onclick="submitInitiateVerifications()">Submit</button>
                </div>
            </div>
            
            <div id="initiates-error" class="error-message" style="display: none;">
                <p>Error loading initiates. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadInitiates()">Retry</button>
            </div>
        </div>

        <!-- ROSTER INFORMATION PAGE -->
        <div id="roster-info" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Roster Information</h2>
            
            <div class="loading-message" id="roster-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading roster information...</p>
            </div>
            
            <div id="roster-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="roster-chapter">-</span></p>
                    <p><strong>Total Candidates:</strong> <span id="roster-candidates-count">0</span></p>
                    <p><strong>Total Initiates:</strong> <span id="roster-initiates-count">0</span></p>
                </div>
                
                <!-- New description section for Roster Information -->
                <div class="page-description">
                    <p>This page allows you to remove members off the collegiate roster. Only provide a status change and start date for members who have left the Chapter/Colony. <a href='https://www.sigmanu.org/file/collegiate-members/officer-resources/commander/members-area-how-to-update-roster.pdf' target='_blank'>How to Use the Members Area</a></p>
                    <p>If Alumni (Graduated), Alumni (Left School), or De-pledge options do not appear, that individual's record has unpaid Candidate or Initiation Fees. If you need assistance in resolving financial issues, please contact <a href='mailto:anthony.tornini@sigmanu.org' target='_blank'>anthony.tornini@sigmanu.org</a>.</p>
                    <p>If you need to add back Candidates who were previously de-pledged, or Initiates who were previous marked as Alumni, please submit your request via email, including the individual's full name and return date, to <a href='mailto:members.area@sigmanu.org' target='_blank'>members.area@sigmanu.org</a>.</p>
                    <p>If you wish to add an Affiliate (a candidate or initiated member from another school), please submit your request via email, including the individual's full name, start date, and previous chapter, to <a href='mailto:anthony.tornini@sigmanu.org' target='_blank'>anthony.tornini@sigmanu.org</a>.</p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="roster-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Current</th>
                                <th>From Date</th>
                                <th>Status</th>
                                <th>Effective Date</th>
                            </tr>
                        </thead>
                        <tbody id="roster-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="reviewRosterChanges()">Review Changes</button>
                </div>
            </div>
            
            <!-- ROSTER REVIEW SECTION -->
            <div id="roster-review" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="roster-review-chapter">-</span></p>
                    <p><strong>Changes to Submit:</strong> <span id="roster-review-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="roster-review-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Current Status</th>
                                <th>New Status</th>
                                <th>Effective Date</th>
                            </tr>
                        </thead>
                        <tbody id="roster-review-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="backToRoster()">Back</button>
                    <button class="btn" onclick="submitRosterChanges()">Submit</button>
                </div>
            </div>
            
            <div id="roster-error" class="error-message" style="display: none;">
                <p>Error loading roster. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadRoster()">Retry</button>
            </div>
        </div>

        <!-- RETURNING STUDENTS PAGE -->
        <div id="returning-students" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Returning Students</h2>
            
            <div class="loading-message" id="returning-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading returning students...</p>
            </div>
            
            <div id="returning-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="returning-chapter">-</span></p>
                    <p><strong>Total Alumni (Left School):</strong> <span id="returning-alumni-count">0</span></p>
                    <p><strong>Total De-Pledge:</strong> <span id="returning-depledge-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="returning-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Current</th>
                                <th>From Date</th>
                                <th>Status</th>
                                <th>Effective Date</th>
                            </tr>
                        </thead>
                        <tbody id="returning-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="reviewReturningChanges()">Review Changes</button>
                </div>
            </div>
            
            <!-- RETURNING STUDENTS REVIEW SECTION -->
            <div id="returning-review" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="returning-review-chapter">-</span></p>
                    <p><strong>Changes to Submit:</strong> <span id="returning-review-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="returning-review-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Current Status</th>
                                <th>New Status</th>
                                <th>Effective Date</th>
                            </tr>
                        </thead>
                        <tbody id="returning-review-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="backToReturning()">Back</button>
                    <button class="btn" onclick="submitReturningChanges()">Submit</button>
                </div>
            </div>
            
            <div id="returning-error" class="error-message" style="display: none;">
                <p>Error loading returning students. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadReturningStudents()">Retry</button>
            </div>
        </div>

        <!-- OFFICER INFORMATION PAGE -->
        <div id="officer-info" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Officer Information</h2>
            
            <div class="loading-message" id="officer-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading officer information...</p>
            </div>
            
            <div id="officer-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="officer-chapter">-</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="officer-table">
                        <thead>
                            <tr>
                                <th>Position</th>
                                <th>Current Officer</th>
                                <th>From Date</th>
                                <th>New Officer</th>
                                <th>Start Date</th>
                            </tr>
                        </thead>
                        <tbody id="officer-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="reviewOfficerChanges()">Review Changes</button>
                </div>
            </div>
            
            <!-- OFFICER REVIEW SECTION -->
            <div id="officer-review" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="officer-review-chapter">-</span></p>
                    <p><strong>Changes to Submit:</strong> <span id="officer-review-count">0</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="officer-review-table">
                        <thead>
                            <tr>
                                <th>Position</th>
                                <th>Current Officer</th>
                                <th>New Officer</th>
                                <th>Start Date</th>
                            </tr>
                        </thead>
                        <tbody id="officer-review-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="backToOfficers()">Back</button>
                    <button class="btn" onclick="submitOfficerChanges()">Submit</button>
                </div>
            </div>
            
            <div id="officer-error" class="error-message" style="display: none;">
                <p>Error loading officers. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadOfficers()">Retry</button>
            </div>
        </div>

        <!-- CHAPTER CONTACT INFORMATION PAGE -->
        <div id="contact-info" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Chapter Contact Information</h2>
            
            <div class="loading-message" id="contact-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading chapter contact information...</p>
            </div>
            
            <div id="contact-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="contact-chapter">-</span></p>
                </div>
                
                <div class="contact-form">
                    <h3>Postal Address</h3>
                    <div class="form-group">
                        <label for="postal-address-1">Address Line 1: <span style="color: red;">*</span></label>
                        <input type="text" id="postal-address-1" placeholder="Enter address line 1" required>
                    </div>
                    <div class="form-group">
                        <label for="postal-address-2">Address Line 2:</label>
                        <input type="text" id="postal-address-2" placeholder="Enter address line 2">
                    </div>
                    <div class="form-group">
                        <label for="postal-city">City: <span style="color: red;">*</span></label>
                        <input type="text" id="postal-city" placeholder="Enter city" required>
                    </div>
                    <div class="form-group">
                        <label for="postal-state">State: <span style="color: red;">*</span></label>
                        <input type="text" id="postal-state" placeholder="Enter state" required>
                    </div>
                    <div class="form-group">
                        <label for="postal-zip">Zip: <span style="color: red;">*</span></label>
                        <input type="text" id="postal-zip" placeholder="Enter zip code" required>
                    </div>
                    
                    <h3>Shipping Address</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="same-as-postal" class="same-address-checkbox">
                            <span>Same as Postal Address</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="shipping-address-1">Address Line 1:</label>
                        <input type="text" id="shipping-address-1" placeholder="Enter address line 1">
                    </div>
                    <div class="form-group">
                        <label for="shipping-address-2">Address Line 2:</label>
                        <input type="text" id="shipping-address-2" placeholder="Enter address line 2">
                    </div>
                    <div class="form-group">
                        <label for="shipping-city">City:</label>
                        <input type="text" id="shipping-city" placeholder="Enter city">
                    </div>
                    <div class="form-group">
                        <label for="shipping-state">State:</label>
                        <input type="text" id="shipping-state" placeholder="Enter state">
                    </div>
                    <div class="form-group">
                        <label for="shipping-zip">Zip:</label>
                        <input type="text" id="shipping-zip" placeholder="Enter zip code">
                    </div>
                    
                    <h3>Chapter Phone/Email</h3>
                    <div class="form-group">
                        <label for="chapter-phone">Chapter Phone:</label>
                        <input type="tel" id="chapter-phone" placeholder="(123) 456-7890">
                    </div>
                    <div class="form-group">
                        <label for="chapter-email">Chapter Email:</label>
                        <input type="email" id="chapter-email" placeholder="chapter@example.com">
                    </div>
                </div>
                
                <div class="submit-section">
                    <button class="btn" onclick="submitContactChanges()">Update Contact Information</button>
                </div>
            </div>
            
            <div id="contact-error" class="error-message" style="display: none;">
                <p>Error loading contact information. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadContactInfo()">Retry</button>
            </div>
        </div>

        <!-- FEE STATUS PAGE -->
        <div id="fee-status" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Fee Status</h2>
            
            <div class="loading-message" id="fee-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading fee status information...</p>
            </div>
            
            <div id="fee-content" style="display: none;">
                <div class="candidates-info">
                    <p><strong>Chapter:</strong> <span id="fee-chapter">-</span></p>
                </div>
                
                <div class="candidates-table-container">
                    <table class="candidates-table" id="fee-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Candidate Fee Paid</th>
                                <th>Initiate Fee Paid</th>
                            </tr>
                        </thead>
                        <tbody id="fee-tbody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="fee-error" class="error-message" style="display: none;">
                <p>Error loading fee status. Please try again or check your authentication.</p>
                <button class="btn" onclick="loadFeeStatus()">Retry</button>
            </div>
        </div>

        <!-- ADMIN PAGE -->
        <div id="admin" class="page">
            <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
            <h2>Admin & Testing</h2>
            
            <!-- Chapter Information Display -->
            <div class="url-params">
                <h3>Chapter Information</h3>
                <p><strong>SID:</strong> <span id="sid">Not provided</span></p>
                <p><strong>Chapter:</strong> <span id="chapter">Not provided</span></p>
                <p><strong>Officer Name:</strong> <span id="offname">Not provided</span></p>
            </div>
            
            <!-- Allow Skips Configuration -->
            <div class="allow-skips-section">
                <h3>Badge Skip Configuration</h3>
                
                <div class="loading-message" id="allow-skips-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading configuration...</p>
                </div>
                
                <div id="allow-skips-content" style="display: none;">
                    <div class="allow-skips-control">
                        <label class="checkbox-label">
                            <input type="checkbox" id="allow-skips-checkbox" class="allow-skip-checkbox">
                            <span>Allow badge number skips for <strong id="current-chapter-name">this chapter</strong></span>
                        </label>
                        <p class="help-text">When enabled, initiates can be assigned non-consecutive badge numbers.</p>
                    </div>
                </div>
                
                <div id="allow-skips-error" class="error-message" style="display: none;">
                    <p>Error loading configuration. Please try again.</p>
                    <button class="btn" onclick="loadAllowSkipsConfig()">Retry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="js/utils.js"></script>
    <script src="js/main.js"></script>
    <script src="js/api.js"></script>
    <script src="js/queries.js"></script>
    <script src="js/candidates.js"></script>
    <script src="js/initiates.js"></script>
    <script src="js/roster.js"></script>
    <script src="js/returning.js"></script>
    <script src="js/officers.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/fees.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        // Configuration
        const CONFIG = window.CONFIG; // Now comes from main.js
        
        // Use the global appState from main.js
        const appState = window.appState;

        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            await Main.init();
        });
    </script>
</body>
</html>